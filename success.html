<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªÙ… Ø¨Ù†Ø¬Ø§Ø­ | Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø­ÙˆØª ğŸ‹âœ¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --main-theme: #002349; --accent-theme: #D4AF37; }
        body { font-family: 'Tajawal', sans-serif; background: #f0f4f8; overflow: hidden; }
        .main-card { background: white; border-radius: 3.5rem; box-shadow: 0 25px 50px -12px rgba(0, 35, 73, 0.2); position: relative; z-index: 10; }
        .bounce-in { animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        @keyframes bounceIn { 0% { opacity: 0; transform: scale(0.3) translateY(100px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="mainBox" class="max-w-md w-full main-card p-8 text-center bounce-in border-t-[12px]" style="border-color: var(--main-theme);">
        
        <div class="flex justify-center mb-2">
            <dotlottie-player src="https://lottie.host/82823631-f923-4412-bd77-2e9154784411/6vR0FvI7oN.json" background="transparent" speed="1.2" style="width: 160px; height: 140px;" loop autoplay></dotlottie-player>
        </div>

        <h1 id="mainGreeting" class="text-3xl font-black mb-1" style="color: var(--main-theme);">Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„Ø¥ØªÙ…Ø§Ù…!</h1>
        <h2 id="userNameDisplay" class="text-xl font-black mb-4" style="color: var(--accent-theme);">...</h2>

        <div class="bg-blue-50/50 p-4 rounded-3xl mb-6">
            <p id="cityBlessing" class="text-blue-900 font-black text-sm leading-relaxed italic">Ø¬Ø§Ø±ÙŠ ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø²Ùƒ ÙÙŠ Ø£Ø±Ø¶ Ø§Ù„Ø­ÙˆØª...</p>
        </div>

        <p id="subInstruction" class="text-slate-500 font-bold text-xs px-4 leading-relaxed mb-6">Ø³ÙŠÙ‚ÙˆÙ… ÙØ±ÙŠÙ‚ Ø§Ù„Ø­ÙˆØª Ø¨Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.</p>

        <div class="bg-slate-50 p-6 rounded-[2.5rem] mb-8 border-2 border-dashed border-slate-200">
            <p id="orderLabel" class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">REFERENCE NUMBER</p>
            <p id="orderIDDisplay" class="text-2xl font-black tracking-tighter" style="color: var(--main-theme);">#HUT-0000</p>
            <div id="summaryText" class="text-[10px] font-bold text-green-600 mt-2 flex items-center justify-center gap-1">
                <i class="fas fa-satellite-dish animate-pulse"></i> ØªÙ… Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­
            </div>
        </div>

        <a id="backBtn" href="index.html" class="block w-full py-5 rounded-2xl font-black text-xl shadow-xl transition-all active:scale-95 text-white" style="background: var(--main-theme);">
            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </a>
    </div>

    <script>
        const u = new URLSearchParams(window.location.search);
        const scriptURL = "https://script.google.com/macros/s/AKfycbznxCVbF350cer5qcXlIROrNmmnf5993r9-AoLbNKqb8YfVNhhT3rREefD7dbK6RFIH/exec"; 
        const lang = u.get('lang') || 'ar';

        window.onload = () => {
            // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡
            let orderID = sessionStorage.getItem('currentOrderID') || "HUT-" + Math.floor(1000 + Math.random() * 9000);
            sessionStorage.setItem('currentOrderID', orderID);
            document.getElementById('orderIDDisplay').innerText = "#" + orderID;
            document.getElementById('userNameDisplay').innerText = u.get('name') || "Ø¹Ù…ÙŠÙ„Ù†Ø§ Ø§Ù„Ø¹Ø²ÙŠØ²";

            // Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø§Ø­ØªÙØ§Ù„
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#002349', '#D4AF37'] });

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù€ Google Sheet
            if (sessionStorage.getItem('orderSent') !== 'true') {
                const payload = {
                    order_id: orderID,
                    name: u.get('name'),
                    phone: u.get('phone'),
                    province: u.get('province') || u.get('city'),
                    car: u.get('car'),
                    days: u.get('days') || "---",
                    addons: u.get('addon_display') || "Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ§Øª",
                    total_price: u.get('total_final'),
                    gender: u.get('gender') || "---",
                    service: u.get('service') || "ØªØ£Ø¬ÙŠØ± Ø¹Ø§Ù…",
                    location_link: u.get('location_link') || "---",
                    national_id: u.get('national_id') || "---",
                    age: u.get('age') || "---"
                };

                fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(payload)
                })
                .then(() => {
                    sessionStorage.setItem('orderSent', 'true');
                    console.log("Data Sent Successfully to Whale Radar");
                })
                .catch(err => console.error("Whale Radar Error:", err));
            }
        };
    </script>
</body>
</html>
