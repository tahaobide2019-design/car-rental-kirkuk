<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlTag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ | Ø§Ù„Ø­ÙˆØª ğŸ‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs" type="module"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f8fafc; transition: 0.5s; }
        .success-card { background: white; border-radius: 3.5rem; box-shadow: 0 30px 60px -12px rgba(0,0,0,0.12); border-top: 12px solid #002349; }
        .badge { background: #f1f5f9; padding: 10px 20px; border-radius: 1rem; font-weight: 800; font-size: 0.8rem; color: #64748b; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="max-w-md w-full success-card p-8 md:p-12 text-center relative overflow-hidden">
        <div class="flex justify-center mb-4">
            <dotlottie-player src="https://lottie.host/82823631-f923-4412-bd77-2e9154784411/6vR0FvI7oN.json" background="transparent" speed="1" style="width: 180px; height: 180px;" loop autoplay></dotlottie-player>
        </div>

        <h1 id="msgTitle" class="text-3xl font-black text-[#002349] mb-4">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!</h1>
        <p id="msgBody" class="text-gray-500 font-bold mb-8 leading-relaxed px-2"></p>

        <div class="grid grid-cols-2 gap-3 mb-8">
            <div class="badge"><i class="fas fa-map-marker-alt ml-1"></i> <span id="resCity"></span></div>
            <div class="badge"><i class="fas fa-calendar-alt ml-1"></i> <span id="resDate"></span></div>
            <div class="col-span-2 badge text-[#002349] border border-blue-100">
                <i class="fas fa-clock ml-1"></i> <span id="resTime"></span>
            </div>
        </div>

        <div class="bg-[#002349] text-[#D4AF37] p-5 rounded-[2rem] mb-8 shadow-lg">
            <p id="lblOrder" class="text-[10px] uppercase font-black opacity-70 mb-1">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</p>
            <p id="orderID" class="text-2xl font-black tracking-widest">#ALHUT-0000</p>
        </div>

        <a href="index.html" id="btnBack" class="block w-full py-4 bg-slate-100 text-slate-600 rounded-2xl font-black hover:bg-slate-200 transition-all">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>

    <script>
        const u = new URLSearchParams(window.location.search);
        const currentLang = u.get('lang') || 'ar';
        const googleScriptURL = "https://script.google.com/macros/s/AKfycbyWczdiWH7eFWgrD7g--bBmAEmrsR43JlvPdc2zPz0j6UobP-FHnED9-LxL9QF3IE_eqA/exec";
        
        const trans = {
            ar: { title: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!', body: 'Ø­ÙˆØªÙ†Ø§ Ø§Ù„Ø¹Ø²ÙŠØ²ØŒ ÙŠØªÙ… Ø§Ù„Ø¢Ù† ØªÙˆØ¬ÙŠÙ‡ Ø·Ù„Ø¨Ùƒ Ù„Ø£Ù‚Ø±Ø¨ Ù…ÙƒØªØ¨ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© (CITY) ÙˆØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø².', back: 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', order: 'Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ', dir: 'rtl', font: 'Tajawal' },
            ku: { title: 'Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Û•Øª ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§!', body: 'Ø­ÙˆØªÛŒ Ø¦Ø§Ø²ÛŒØ²ØŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Û•Øª Ø¦Ø§Ú•Ø§Ø³ØªÛ•ÛŒ Ù†Ø²ÛŒÚ©ØªØ±ÛŒÙ† Ù†ÙˆÙˆØ³ÛŒÙ†Ú¯Û• Ø¯Û•Ú©Ø±ÛØª Ù„Û• (CITY) Ùˆ Ø¨Û•Ù… Ø²ÙˆÙˆØ§Ù†Û• Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒØª Ù¾ÛÙˆÛ• Ø¯Û•Ú©Û•ÛŒÙ†.', back: 'Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ• Ø¨Û† Ø³Û•Ø±Û•ØªØ§', order: 'Ú˜Ù…Ø§Ø±Û•ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ', dir: 'rtl', font: 'Tajawal' },
            tr: { title: 'SipariÅŸiniz AlÄ±ndÄ±!', body: 'DeÄŸerli mÃ¼ÅŸterimiz, talebiniz (CITY) bÃ¶lgesindeki en yakÄ±n ofise iletiliyor. Onay iÃ§in sizinle iletiÅŸime geÃ§eceÄŸiz.', back: 'Ana Sayfaya DÃ¶n', order: 'SÄ°PARÄ°Å NUMARASI', dir: 'ltr', font: 'Poppins' },
            en: { title: 'Order Received!', body: 'Dear Whale, your request is being routed to the nearest office in (CITY). We will contact you shortly.', back: 'Back to Home', order: 'ORDER REFERENCE', dir: 'ltr', font: 'Poppins' }
        };

        window.onload = () => {
            const l = trans[currentLang];
            document.getElementById('htmlTag').dir = l.dir;
            document.body.style.fontFamily = l.font;
            document.getElementById('msgTitle').innerText = l.title;
            document.getElementById('btnBack').innerText = l.back;
            document.getElementById('lblOrder').innerText = l.order;
            
            const city = decodeURIComponent(u.get('province') || u.get('city') || '...');
            document.getElementById('msgBody').innerText = l.body.replace('(CITY)', city);
            document.getElementById('resCity').innerText = city;
            document.getElementById('resDate').innerText = u.get('date') || '--/--';
            document.getElementById('resTime').innerText = u.get('time') || '--:--';
            
            const randomID = '#ALHUT-' + Math.floor(1000 + Math.random() * 9000);
            document.getElementById('orderID').innerText = randomID;

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹ Ù„Ø¬Ø¯ÙˆÙ„ Ø¬ÙˆØ¬Ù„
            submitToGoogle(u, randomID);
        };

        function submitToGoogle(params, orderID) {
            const data = {
                order_id: orderID,
                timestamp: new Date().toLocaleString()
            };
            // ØªØ­ÙˆÙŠÙ„ ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù† Ø¨ÙŠØ§Ù†Ø§Øª
            params.forEach((value, key) => { data[key] = decodeURIComponent(value); });

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù€ Google Apps Script
            fetch(googleScriptURL, {
                method: 'POST',
                mode: 'no-cors', // Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ CORS Ù…Ø¹ Ø¬ÙˆØ¬Ù„
                cache: 'no-cache',
                body: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' }
            }).then(() => {
                console.log("Data sent to Google Sheet successfully!");
            }).catch(err => console.error("Error sending data:", err));
        }
    </script>
</body>
</html>
