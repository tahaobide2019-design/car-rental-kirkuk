<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlTag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="docTitle">ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠ | ÿπÿßÿ¶ŸÑÿ© ÿßŸÑÿ≠Ÿàÿ™ üêã‚ú®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --main-theme: #002349; --accent-theme: #D4AF37; }
        body { font-family: 'Tajawal', 'Poppins', sans-serif; background: #f0f4f8; overflow: hidden; }
        .main-card { background: white; border-radius: 3.5rem; box-shadow: 0 25px 50px -12px rgba(0, 35, 73, 0.2); position: relative; z-index: 10; border-top: 12px solid var(--main-theme); }
        .bounce-in { animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        @keyframes bounceIn { 0% { opacity: 0; transform: scale(0.3) translateY(100px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="mainBox" class="max-w-md w-full main-card p-8 text-center bounce-in">
        <div class="flex justify-center mb-2">
            <dotlottie-player src="https://lottie.host/82823631-f923-4412-bd77-2e9154784411/6vR0FvI7oN.json" background="transparent" speed="1.2" style="width: 160px; height: 140px;" loop autoplay></dotlottie-player>
        </div>

        <h1 id="mainGreeting" class="text-3xl font-black mb-1" style="color: var(--main-theme);">---</h1>
        <h2 id="userNameDisplay" class="text-xl font-black mb-4" style="color: var(--accent-theme);">...</h2>

        <div class="bg-blue-50/50 p-4 rounded-3xl mb-6">
            <p id="statusMsg" class="text-blue-900 font-black text-sm leading-relaxed italic">---</p>
        </div>

        <p id="subInstruction" class="text-slate-500 font-bold text-xs px-4 leading-relaxed mb-6">---</p>

        <div class="bg-slate-50 p-6 rounded-[2.5rem] mb-8 border-2 border-dashed border-slate-200">
            <p id="orderLabel" class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">REFERENCE NUMBER</p>
            <p id="orderIDDisplay" class="text-2xl font-black tracking-tighter" style="color: var(--main-theme);">#HUT-0000</p>
            <div id="summaryText" class="text-[10px] font-bold text-green-600 mt-2 flex items-center justify-center gap-1">
                <i id="syncIcon" class="fas fa-satellite-dish animate-pulse"></i> <span id="syncText">---</span>
            </div>
        </div>

        <a id="backBtn" href="index.html" class="block w-full py-5 rounded-2xl font-black text-xl shadow-xl transition-all active:scale-95 text-white" style="background: var(--main-theme);">
            ---
        </a>
    </div>

    <script>
        const u = new URLSearchParams(window.location.search);
        const lang = u.get('lang') || 'ar';
        const type = u.get('type') || 'personal';
        const scriptURL = "https://script.google.com/macros/s/AKfycbznxCVbF350cer5qcXlIROrNmmnf5993r9-AoLbNKqb8YfVNhhT3rREefD7dbK6RFIH/exec";

        const configs = {
            training: { main: '#7c3aed', accent: '#6d28d9' },
            wedding: { main: '#be185d', accent: '#9d174d' },
            personal: { main: '#002349', accent: '#D4AF37' }
        };

        const content = {
            ar: { greet: "ŸÖÿ®ÿßÿ±ŸÉ ÿßŸÑÿ•ÿ™ŸÖÿßŸÖ!", status: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ£ŸÉŸäÿØ ÿ≠ÿ¨ÿ≤ŸÉ ŸÅŸä ÿ£ÿ±ÿ∂ ÿßŸÑÿ≠Ÿàÿ™...", sub: "ÿ≥ŸäŸÇŸàŸÖ ŸÅÿ±ŸäŸÇ ÿßŸÑÿ≠Ÿàÿ™ ÿ®ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÉ ŸÇÿ±Ÿäÿ®ÿßŸã.", sync: "ÿ™ŸÖ ÿßŸÑÿ±ÿ®ÿ∑ ÿ®ŸÜÿ¨ÿßÿ≠", back: "ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©", welcome: "ÿπŸÖŸäŸÑŸÜÿß ÿßŸÑÿπÿ≤Ÿäÿ≤", already: "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ∑ŸÑÿ® ŸÖÿ≥ÿ®ŸÇÿßŸã" },
            ku: { greet: "Ÿæ€åÿ±€Üÿ≤€ï!", status: "ÿØÿßŸàÿß⁄©ÿßÿ±€å€å€ï⁄©€ïÿ™ ŸÑ€ï ÿ≤€ïŸà€å ÿ≠Ÿàÿ™ ÿ™€ÜŸÖÿßÿ±⁄©ÿ±ÿß...", sub: "ÿ™€åŸÖ€å ÿ≠Ÿàÿ™ ÿ®€ïŸÖ ÿ≤ŸàÿßŸÜ€ï Ÿæ€ï€åŸà€ïŸÜÿØ€åÿ™ Ÿæ€éŸà€ï ÿØ€ï⁄©€ïŸÜ.", sync: "ÿ®€ïÿ≥€ïÿ±⁄©€ïŸàÿ™ŸàŸà€å€å ÿ®€ïÿ≥ÿ™ÿ±ÿßŸà€ïÿ™€ïŸà€ï", back: "⁄Ø€ï⁄ïÿßŸÜ€ïŸà€ï ÿ®€Ü ÿ≥€ïÿ±€ïÿ™ÿß", welcome: "⁄©⁄ï€åÿßÿ±€å ÿ®€ï⁄ï€éÿ≤", already: "ÿØÿßŸàÿß⁄©ÿßÿ±€å€å€ï⁄©€ï Ÿæ€éÿ¥ÿ™ÿ± ÿ™€ÜŸÖÿßÿ±⁄©ÿ±ÿßŸà€ï" }
        };

        window.onload = () => {
            const c = configs[type] || configs.personal;
            const l = content[lang] || content.ar;
            const isRtl = (lang === 'ar' || lang === 'ku');

            document.documentElement.style.setProperty('--main-theme', c.main);
            document.documentElement.style.setProperty('--accent-theme', c.accent);
            document.getElementById('htmlTag').dir = isRtl ? 'rtl' : 'ltr';

            document.getElementById('mainGreeting').innerText = l.greet;
            document.getElementById('statusMsg').innerText = l.status;
            document.getElementById('subInstruction').innerText = l.sub;
            document.getElementById('backBtn').innerText = l.back;
            document.getElementById('userNameDisplay').innerText = u.get('name') || l.welcome;

            let sessionOrderID = sessionStorage.getItem('last_hut_id');
            if(!sessionOrderID) {
                sessionOrderID = "HUT-" + Math.floor(1000 + Math.random() * 9000);
                sessionStorage.setItem('last_hut_id', sessionOrderID);
            }
            document.getElementById('orderIDDisplay').innerText = "#" + sessionOrderID;

            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: [c.main, c.accent] });

            if (sessionStorage.getItem('order_sent') === 'true') {
                document.getElementById('syncText').innerText = l.already;
                document.getElementById('syncIcon').classList.remove('animate-pulse');
                return;
            }

            // ÿßŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ¨ÿ∞ÿ±Ÿä ŸáŸÜÿß ŸÑŸäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ ÿßŸÑŸÄ Apps Script ŸÅŸä ÿµŸàÿ±ÿ™ŸÉ ÿßŸÑŸÖÿ±ŸÅŸÇÿ©
            const payload = {
                order_id: sessionOrderID,                    // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.order_id
                name: u.get('name') || "---",                // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.name
                phone: u.get('phone') || "---",              // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.phone
                province: u.get('province') || u.get('city') || "---", // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.province
                car: u.get('car') || "---",                  // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.car
                days: u.get('days') || "---",                // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.days
                addons: u.get('addon_display') || "---",     // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.addons
                total_price: u.get('total_final') || "0",    // ÿßŸÑÿ™ÿπÿØŸäŸÑ: ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ price ÿ®ŸÄ total_price ŸÑŸäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ ÿßŸÑÿ≥ŸÉÿ±Ÿäÿ®ÿ™
                gender: u.get('gender') || "---",            // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.gender
                age: u.get('age') || "---",                  // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.age
                national_id: u.get('national_id') || "---",  // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.national_id
                license_no: u.get('license_id') || "---",    // ÿßŸÑÿ™ÿπÿØŸäŸÑ: ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ license_id ÿ®ŸÄ license_no ŸÑŸäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ ÿßŸÑÿ≥ŸÉÿ±Ÿäÿ®ÿ™
                service: u.get('service') || u.get('type') || "---", // Ÿäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ d.service
                location_link: u.get('location_link') || "---" // ÿßŸÑÿ™ÿπÿØŸäŸÑ: ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ map_link ÿ®ŸÄ location_link ŸÑŸäÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπ ÿßŸÑÿ≥ŸÉÿ±Ÿäÿ®ÿ™
            };

            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(payload)
            }).then(() => {
                sessionStorage.setItem('order_sent', 'true');
                document.getElementById('syncText').innerText = l.sync;
            }).catch(err => {
                console.error("Sync failed:", err);
                document.getElementById('syncText').innerText = "Sync Error";
            });
        };
    </script>
</body>
</html>
