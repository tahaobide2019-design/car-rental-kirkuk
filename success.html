<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªÙ… Ø¨Ù†Ø¬Ø§Ø­ | Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ø­ÙˆØª ğŸ‹âœ¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --main-theme: #002349; --accent-theme: #D4AF37; }
        body { font-family: 'Tajawal', sans-serif; background: #f0f4f8; overflow: hidden; }
        .main-card { background: white; border-radius: 3.5rem; box-shadow: 0 25px 50px -12px rgba(0, 35, 73, 0.2); position: relative; z-index: 10; }
        .bounce-in { animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        @keyframes bounceIn { 0% { opacity: 0; transform: scale(0.3) translateY(100px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="mainBox" class="max-w-md w-full main-card p-8 text-center bounce-in border-t-[12px]" style="border-color: var(--main-theme);">
        
        <div class="flex justify-center mb-2">
            <dotlottie-player src="https://lottie.host/82823631-f923-4412-bd77-2e9154784411/6vR0FvI7oN.json" background="transparent" speed="1.2" style="width: 160px; height: 140px;" loop autoplay></dotlottie-player>
        </div>

        <h1 id="mainGreeting" class="text-3xl font-black mb-1" style="color: var(--main-theme);">...</h1>
        <h2 id="userNameDisplay" class="text-xl font-black mb-4" style="color: var(--accent-theme);">...</h2>

        <div class="bg-blue-50/50 p-4 rounded-3xl mb-6">
            <p id="cityBlessing" class="text-blue-900 font-black text-sm leading-relaxed italic">...</p>
        </div>

        <p id="subInstruction" class="text-slate-500 font-bold text-xs px-4 leading-relaxed mb-6">...</p>

        <div class="bg-slate-50 p-6 rounded-[2.5rem] mb-8 border-2 border-dashed border-slate-200">
            <p id="orderLabel" class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">REFERENCE NUMBER</p>
            <p id="orderIDDisplay" class="text-2xl font-black tracking-tighter" style="color: var(--main-theme);">#HUT-0000</p>
            <div id="summaryText" class="text-[10px] font-bold text-green-600 mt-2 flex items-center justify-center gap-1">
                <i class="fas fa-satellite-dish animate-pulse"></i> RADAR CONNECTED
            </div>
        </div>

        <a id="backBtn" href="index.html" class="block w-full py-5 rounded-2xl font-black text-xl shadow-xl transition-all active:scale-95 text-white" style="background: var(--main-theme);">
            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </a>
    </div>

    <script>
        const u = new URLSearchParams(window.location.search);
        const scriptURL = "https://script.google.com/macros/s/AKfycbznxCVbF350cer5qcXlIROrNmmnf5993r9-AoLbNKqb8YfVNhhT3rREefD7dbK6RFIH/exec"; //
        const lang = u.get('lang') || 'ar';

        // 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚ÙˆØ§Ù…ÙŠØ³ (Ø¹Ø±Ø¶ Ù„Ù„Ø²Ø¨ÙˆÙ† vs Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³ÙƒØ±ÙŠØ¨Øª)
        const uiContent = {
            ar: { greet: "Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„Ø¥ØªÙ…Ø§Ù…!", sub: "Ø³ÙŠÙ‚ÙˆÙ… Ø£Ù‚Ø±Ø¨ Ù…ÙƒØªØ¨ Ø­ÙˆØª Ø¨Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‡Ø§ØªÙÙŠØ§Ù‹ Ù„Ø¥ØªÙ…Ø§Ù… Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ….", btn: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", orderL: "Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ" },
            ku: { greet: "Ù¾ÛŒØ±Û†Ø²Û•!", sub: "Ù†Ø²ÛŒÚ©ØªØ±ÛŒÙ† Ø¦Û†ÙÛŒØ³ÛŒ Ø­ÙˆØª Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒØª Ù¾ÛÙˆÛ• Ø¯Û•Ú©Ø§Øª Ø¨Û† ØªÛ•ÙˆØ§ÙˆÚ©Ø±Ø¯Ù†ÛŒ Ú•ÛÚ©Ø§Ø±Û•Ú©Ø§Ù†ÛŒ Ú•Ø§Ø¯Û•Ø³ØªÚ©Ø±Ø¯Ù†.", btn: "Ø¨Ú¯Û•Ú•ÛÙˆÛ• Ø³Û•Ø±Û•Ú©ÛŒ", orderL: "Ú˜Ù…Ø§Ø±Û•ÛŒ ØªÛ•Ø±Ø®Ø§Ù†Ú©Ø±Ø¯Ù†" },
            en: { greet: "Success!", sub: "The nearest Whale office will contact you via phone to complete the delivery process.", btn: "Back to Home", orderL: "REFERENCE NUMBER" },
            tr: { greet: "Tebrikler!", sub: "En yakÄ±n Whale ofisi, teslimat iÅŸlemlerini tamamlamak iÃ§in sizinle telefonla iletiÅŸime geÃ§ecektir.", btn: "Ana Sayfaya DÃ¶n", orderL: "REFERANS NUMARASI" }
        };

        const cityBlessings = {
            "Ø¨ØºØ¯Ø§Ø¯": "ÙŠØ±Ø¹Ø§Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠ Ø£Ø±Ø¶ Ù‡Ø§Ø±ÙˆÙ† Ø§Ù„Ø±Ø´ÙŠØ¯ Ø¨ØºØ¯Ø§Ø¯ ğŸ°",
            "ÙƒØ±ÙƒÙˆÙƒ": "Ø­ÙŠØ§Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠ Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù‚Ù„Ø§Ø¹ ÙˆØ§Ù„Ø¥Ø®Ø§Ø¡ ÙƒØ±ÙƒÙˆÙƒ ğŸ’",
            "Ø§Ù„Ø¨ØµØ±Ø©": "Ø¹Ù„Ù‰ Ø±Ø§Ø³ÙŠ Ø£Ù‡Ù„Ù†Ø§ ÙÙŠ Ø«ØºØ± Ø§Ù„Ø¹Ø±Ø§Ù‚ Ø§Ù„Ø¨Ø§Ø³Ù… Ø§Ù„Ø¨ØµØ±Ø© ğŸŒŠ",
            "Ø£Ø±Ø¨ÙŠÙ„": "Ù†ÙˆØ±ØªÙ†Ø§ ÙÙŠ Ø­Ø¶Ù† Ø§Ù„Ù‚Ù„Ø¹Ø© Ø§Ù„Ø´Ø§Ù…Ø®Ø© Ø£Ø±Ø¨ÙŠÙ„ ğŸ”ï¸",
            "default": "ÙŠØ±Ø¹Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø£ÙŠÙ†Ù…Ø§ ÙƒÙ†Øª ÙÙŠ Ø£Ø±Ø¶ Ø§Ù„Ø¹Ø±Ø§Ù‚ Ø§Ù„Ø¹Ø¸ÙŠÙ… ğŸ‡®ğŸ‡¶"
        };

        // Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¹ÙƒØ³ÙŠØ© (Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©)
        const toScriptMap = {
            // Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª
            "Kirkuk": "ÙƒØ±ÙƒÙˆÙƒ", "KerkÃ¼k": "ÙƒØ±ÙƒÙˆÙƒ", "Ú©Û•Ø±Ú©ÙˆÚ©": "ÙƒØ±ÙƒÙˆÙƒ",
            "Baghdad": "Ø¨ØºØ¯Ø§Ø¯", "BaÄŸdat": "Ø¨ØºØ¯Ø§Ø¯", "Ø¨Û•ØºØ¯Ø§": "Ø¨ØºØ¯Ø§Ø¯",
            "Erbil": "Ø£Ø±Ø¨ÙŠÙ„", "Erbil": "Ø£Ø±Ø¨ÙŠÙ„", "Ù‡Û•ÙˆÙ„ÛØ±": "Ø£Ø±Ø¨ÙŠÙ„",
            // Ø§Ù„Ø®Ø¯Ù…Ø§Øª
            "personal": "ØªØ£Ø¬ÙŠØ± Ø´Ø®ØµÙŠ", "wedding": "Ø£Ø¹Ø±Ø§Ø³ ÙˆÙ…Ù†Ø§Ø³Ø¨Ø§Øª", "training": "ØªØ¹Ù„ÙŠÙ… Ù‚ÙŠØ§Ø¯Ø©",
            // Ø§Ù„Ø¬Ù†Ø³
            "Male": "Ø°ÙƒØ±", "Erkek": "Ø°ÙƒØ±", "Ù†ÛØ±": "Ø°ÙƒØ±",
            "Female": "Ø£Ù†Ø«Ù‰", "KadÄ±n": "Ø£Ù†Ø«Ù‰", "Ù…Û": "Ø£Ù†Ø«Ù‰"
        };

        function translateToScript(val) { return toScriptMap[val] || val || "---"; }

        window.onload = () => {
            // Ø¶Ø¨Ø· ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù„ØºØ© Ø§Ù„Ø²Ø¨ÙˆÙ†
            const ui = uiContent[lang] || uiContent.ar;
            document.getElementById('mainGreeting').innerText = ui.greet;
            document.getElementById('subInstruction').innerText = ui.sub;
            document.getElementById('backBtn').innerText = ui.btn;
            document.getElementById('orderLabel').innerText = ui.orderL;
            document.dir = (lang === 'ar' || lang === 'ku') ? 'rtl' : 'ltr';

            let orderID = sessionStorage.getItem('currentOrderID') || "HUT-" + Math.floor(1000 + Math.random() * 9000);
            sessionStorage.setItem('currentOrderID', orderID);
            document.getElementById('orderIDDisplay').innerText = "#" + orderID;

            const rawCity = u.get('city') || u.get('prov') || "Ø¨ØºØ¯Ø§Ø¯";
            const scriptCity = translateToScript(rawCity);
            document.getElementById('cityBlessing').innerText = cityBlessings[scriptCity] || cityBlessings["default"];
            document.getElementById('userNameDisplay').innerText = u.get('name') || "...";

            // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ø­ØªÙØ§Ù„ ğŸŠ
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#002349', '#D4AF37'] });

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù„ØºØ© Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©)
            if (sessionStorage.getItem('orderSent') !== 'true') {
                const data = {
                    order_id: orderID,
                    name: u.get('name'),
                    phone: u.get('phone'),
                    province: scriptCity, // ØªØ±Ø³Ù„ ÙƒÙ€ "ÙƒØ±ÙƒÙˆÙƒ" Ù…Ù‡Ù…Ø§ ÙƒØ§Ù†Øª Ù„ØºØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    car: u.get('car'),
                    days: u.get('days') || u.get('date'),
                    addons: u.get('addon_name') || "Ø£Ø³Ø§Ø³ÙŠØ©",
                    total_price: u.get('price'),
                    gender: translateToScript(u.get('gender')),
                    service: translateToScript(u.get('type')),
                    location_link: u.get('map') || ""
                };

                fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(data)
                }).then(() => sessionStorage.setItem('orderSent', 'true'));
            }
        };
    </script>
</body>
</html>
