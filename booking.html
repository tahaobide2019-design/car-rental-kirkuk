<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إتمام الحجز | شركة الحوت</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f4f7fa; }
        .bg-whale { background-color: #002349; }
        .text-gold { color: #D4AF37; }
        .booking-stage { display: none; }
        .booking-stage.active { display: block; animation: fadeInUp 0.5s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .step-item.active .num { background: #D4AF37; color: #002349; box-shadow: 0 0 10px rgba(212,175,55,0.5); }
    </style>
</head>
<body class="py-10 px-4">

    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-10 max-w-lg mx-auto relative px-4">
            <div class="absolute h-1 bg-gray-200 w-full top-5 -z-10"></div>
            <div class="step-item active" id="st1"><div class="num w-10 h-10 rounded-full bg-white border-2 flex items-center justify-center font-bold mx-auto transition">1</div></div>
            <div class="step-item" id="st2"><div class="num w-10 h-10 rounded-full bg-white border-2 flex items-center justify-center font-bold mx-auto transition">2</div></div>
            <div class="step-item" id="st3"><div class="num w-10 h-10 rounded-full bg-white border-2 flex items-center justify-center font-bold mx-auto transition">3</div></div>
        </div>

        <div class="bg-white rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px] border border-gray-100">
            <div class="flex-1 p-8 md:p-12">
                
                <div class="booking-stage active" id="stage1">
                    <h2 class="text-3xl font-black mb-6 text-whale">تأكيد الخدمة</h2>
                    <div class="p-6 bg-gray-50 border-2 border-gold rounded-3xl mb-8 flex items-center gap-4">
                        <i class="fas fa-shuttle-van text-4xl text-gold"></i>
                        <div>
                            <h3 id="conf-title" class="font-bold text-xl">جاري تحميل البيانات...</h3>
                            <p class="text-gray-500 text-sm">اضغط على التالي لتخصيص طلبك</p>
                        </div>
                    </div>
                    <button onclick="goTo(2)" class="w-full bg-whale text-white py-4 rounded-2xl font-bold hover:bg-opacity-90 transition">التالي: الإضافات</button>
                </div>

                <div class="booking-stage" id="stage2">
                    <h2 class="text-3xl font-black mb-6 text-whale">إضافات وتجهيز</h2>
                    
                    <div id="personalExtras" class="space-y-4 mb-8 hidden">
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-gold transition">
                            <div class="flex items-center gap-3"><i class="fas fa-truck text-gold"></i> <b>توصيل السيارة للمنزل</b></div>
                            <div class="flex items-center gap-3"><span>10,000 د.ع</span> <input type="checkbox" value="10000" data-name="توصيل" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-gold transition">
                            <div class="flex items-center gap-3"><i class="fas fa-baby text-gold"></i> <b>كرسي أطفال</b></div>
                            <div class="flex items-center gap-3"><span>10,000 د.ع</span> <input type="checkbox" value="10000" data-name="كرسي أطفال" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-gold transition">
                            <div class="flex items-center gap-3"><i class="fas fa-user-tie text-gold"></i> <b>سائق خاص</b></div>
                            <div class="flex items-center gap-3"><span>50,000 د.ع</span> <input type="checkbox" value="50000" data-name="سائق خاص" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                    </div>

                    <div id="weddingExtras" class="hidden space-y-4 mb-8">
                        <div class="bg-pink-50 p-5 rounded-2xl border-2 border-pink-100 mb-6">
                            <label class="block text-sm font-black mb-2 text-pink-700">عدد السيارات المطلوبة للحفلة:</label>
                            <input type="number" id="weddingQty" value="1" min="1" onchange="calcPrice()" class="w-full p-3 rounded-xl border-2 border-pink-200 outline-none focus:border-pink-500 font-bold">
                        </div>
                        <label class="flex justify-between items-center p-4 bg-gray-50 rounded-2xl cursor-pointer border-2 border-transparent hover:border-pink-400 transition">
                            <div class="flex items-center gap-3"><i class="fas fa-leaf text-pink-600"></i> <b>تزيين ورد طبيعي</b></div>
                            <div class="flex items-center gap-3"><span>75,000 د.ع</span> <input type="checkbox" value="75000" data-name="ورد طبيعي" onchange="calcPrice()" class="extra-check w-6 h-6"></div>
                        </label>
                    </div>

                    <button onclick="goTo(3)" class="w-full bg-whale text-white py-4 rounded-2xl font-bold">التالي: بيانات الحجز</button>
                </div>

                <div class="booking-stage" id="stage3">
                    <h2 class="text-3xl font-black mb-6 text-whale">بيانات الزبون والموقع</h2>
                    <div class="space-y-4">
                        <input type="text" id="custName" placeholder="الاسم الكامل" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold">
                        <input type="tel" id="custPhone" placeholder="رقم الموبايل" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold">
                        
                        <div id="legalSection" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="idDoc" placeholder="رقم الهوية / جواز السفر" class="w-full p-4 bg-gray-50 border-2 border-gold/20 rounded-2xl outline-none focus:border-gold">
                            <input type="text" id="licDoc" placeholder="رقم إجازة السوق" class="w-full p-4 bg-gray-50 border-2 border-gold/20 rounded-2xl outline-none focus:border-gold">
                        </div>

                        <textarea id="custAddr" placeholder="عنوان التسليم بالتفصيل" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-gold h-28"></textarea>
                        <button onclick="getGPS()" class="w-full py-3 bg-blue-50 text-blue-700 rounded-xl font-bold flex justify-center items-center gap-2"><i class="fas fa-map-marker-alt"></i> تحديد موقع GPS</button>
                        <input type="hidden" id="custCoords">
                        <button onclick="submitOrder()" class="w-full bg-green-600 text-white py-5 rounded-2xl font-black text-xl flex justify-center items-center gap-3 shadow-xl">تأكيد وإرسال واتساب <i class="fab fa-whatsapp"></i></button>
                    </div>
                </div>
            </div>

            <div class="w-full md:w-[380px] bg-whale text-white p-10 flex flex-col justify-between border-r border-white/5">
                <div>
                    <h3 class="text-xl font-bold border-b border-white/10 pb-4 mb-8 text-gold flex items-center gap-2"><i class="fas fa-file-invoice"></i> ملخص الطلب</h3>
                    <div class="space-y-5">
                        <div class="flex justify-between"><span>نوع الخدمة:</span> <span id="resType" class="font-bold">-</span></div>
                        <div class="flex justify-between"><span>تاريخ الاستلام:</span> <span id="resDate" class="font-bold">-</span></div>
                        <div id="extrasList" class="text-xs text-gold font-bold italic py-2 leading-relaxed"></div>
                    </div>
                </div>
                <div class="pt-6 border-t border-white/10">
                    <p class="text-sm opacity-50 mb-1 font-bold">المبلغ الإجمالي:</p>
                    <span id="resTotal" class="text-3xl font-black text-gold">0 د.ع</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let basePrice = 0;
        let cType = '';

        function goTo(n) {
            document.querySelectorAll('.booking-stage').forEach(s => s.classList.remove('active'));
            document.getElementById('stage' + n).classList.add('active');
            for(let i=1; i<=3; i++) {
                const step = document.getElementById('st' + i);
                if(i <= n) step.classList.add('active'); else step.classList.remove('active');
            }
        }

        window.onload = function() {
            const p = new URLSearchParams(window.location.search);
            cType = p.get('type');
            const date = p.get('date'), pr = p.get('price'), veh = p.get('vehicle');

            document.getElementById('resDate').innerText = date || 'غير محدد';

            if (cType === 'personal') {
                basePrice = 50000;
                document.getElementById('resType').innerText = "سيارة شخصية";
                document.getElementById('conf-title').innerText = "تأكيد حجز سيارة شخصية";
                document.getElementById('personalExtras').classList.remove('hidden');
                document.getElementById('legalSection').classList.remove('hidden');
                goTo(1);
            } 
            else if (cType === 'wedding') {
                basePrice = 75000;
                document.getElementById('resType').innerText = "سيارات مزينة للحفلات";
                document.getElementById('conf-title').innerText = "تأكيد حجز سيارات زفة";
                document.getElementById('weddingExtras').classList.remove('hidden');
                document.getElementById('legalSection').classList.remove('hidden');
                goTo(1);
            }
            else {
                // للتعليم والحمل - قفز مباشر للتصميم الفخم (المرحلة 3)
                basePrice = parseInt(pr) || 100000;
                document.getElementById('resType').innerText = (cType === 'training') ? "تعليم قيادة" : `حمل (${veh})`;
                document.getElementById('conf-title').innerText = "بيانات التوصيل";
                document.getElementById('legalSection').classList.add('hidden');
                goTo(3); 
            }
            calcPrice();
        };

        function calcPrice() {
            let extra = 0; let names = [];
            const qty = (cType === 'wedding') ? parseInt(document.getElementById('weddingQty').value) || 1 : 1;
            
            document.querySelectorAll('.extra-check:checked').forEach(c => {
                extra += parseInt(c.value);
                names.push(c.getAttribute('data-name'));
            });

            const total = (basePrice * qty) + extra;
            document.getElementById('resTotal').innerText = total.toLocaleString() + " د.ع";
            
            let listText = (cType === 'wedding') ? `العدد: ${qty} سيارة` : "";
            if(names.length > 0) listText += (listText ? " | " : "") + "الإضافات: " + names.join(' + ');
            document.getElementById('extrasList').innerText = listText;
        }

        function getGPS() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    document.getElementById('custCoords').value = p.coords.latitude + "," + p.coords.longitude;
                    alert("✅ تم التقاط الموقع بنجاح");
                });
            }
        }

        function submitOrder() {
            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            const addr = document.getElementById('custAddr').value;
            const total = document.getElementById('resTotal').innerText;
            const summary = document.getElementById('extrasList').innerText;

            if(!name || !phone || !addr) { alert("⚠️ أكمل البيانات المطلوبة"); return; }

            let legalData = "";
            if (cType === 'personal' || cType === 'wedding') {
                const id = document.getElementById('idDoc').value;
                const lic = document.getElementById('licDoc').value;
                if(!id || !lic) { alert("⚠️ رقم الهوية والإجازة ضروري لهذه الخدمة"); return; }
                legalData = `%0A*رقم الهوية:* ${id}%0A*رقم الإجازة:* ${lic}`;
            }

            const msg = `*طلب حجز - شركة الحوت*%0A---------------------------%0A*الخدمة:* ${document.getElementById('resType').innerText}${legalData}%0A*العميل:* ${name}%0A*الهاتف:* ${phone}%0A*التاريخ:* ${document.getElementById('resDate').innerText}%0A*العنوان:* ${addr}%0A*التفاصيل:* ${summary}%0A*الإجمالي:* ${total}%0A*الموقع:* http://googleusercontent.com/maps.google.com/7${document.getElementById('custCoords').value}`;
            
            window.open(`https://wa.me/9647713225471?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>
