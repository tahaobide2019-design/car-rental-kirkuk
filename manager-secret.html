<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUTA COMMANDER | Ultra Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #050a14; color: #e2e8f0; font-family: 'Tajawal', sans-serif; overflow-x: hidden; }
        .cyber-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 2.5rem; }
        .stat-card { background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.8)); border-radius: 2rem; border: 1px solid rgba(255, 255, 255, 0.03); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .stat-card:hover { border-color: rgba(212, 175, 55, 0.3); transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); }
        .tab-btn { position: relative; padding: 12px 24px; font-weight: 700; font-size: 13px; color: #64748b; transition: all 0.3s; }
        .tab-btn.active { color: #D4AF37; }
        .tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 25%; width: 50%; height: 3px; background: #D4AF37; border-radius: 10px; box-shadow: 0 0 15px #D4AF37; }
        .order-card { background: rgba(30, 41, 59, 0.3); border: 1px solid rgba(255, 255, 255, 0.05); border-right-width: 5px; transition: all 0.3s; }
        .order-card:hover { background: rgba(30, 41, 59, 0.5); border-right-width: 10px; }
        .wave-container { height: 40px; display: flex; align-items: center; gap: 3px; justify-content: center; opacity: 0.5; }
        .wave-bar { width: 3px; background: #D4AF37; border-radius: 50px; animation: wave 1.2s ease-in-out infinite; }
        @keyframes wave { 0%, 100% { height: 5px; } 50% { height: 25px; } }
        .search-glow:focus { box-shadow: 0 0 15px rgba(212, 175, 55, 0.1); border-color: #D4AF37; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-10 gap-6">
            <div class="flex items-center gap-5">
                <div class="relative">
                    <div class="w-16 h-16 bg-[#D4AF37] rounded-3xl flex items-center justify-center text-[#050a14] shadow-[0_0_30px_rgba(212,175,55,0.4)]">
                        <i class="fas fa-whale text-2xl"></i>
                    </div>
                    <span class="absolute -top-1 -right-1 flex h-4 w-4">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-4 w-4 bg-green-500 border-2 border-[#050a14]"></span>
                    </span>
                </div>
                <div>
                    <h1 class="text-3xl font-black tracking-tighter text-white">HUTA <span class="text-[#D4AF37] font-normal italic">COMMANDER</span></h1>
                    <p class="text-[9px] font-bold text-slate-500 tracking-[0.4em] uppercase">Ultra Secret Control System v2.0</p>
                </div>
            </div>

            <div class="wave-container hidden md:flex">
                <div class="wave-bar" style="animation-delay: 0.1s"></div>
                <div class="wave-bar" style="animation-delay: 0.3s"></div>
                <div class="wave-bar" style="animation-delay: 0.5s"></div>
                <div class="wave-bar" style="animation-delay: 0.2s"></div>
                <div class="wave-bar" style="animation-delay: 0.4s"></div>
            </div>

            <button onclick="loadAdminData()" class="bg-white/5 hover:bg-white/10 text-white border border-white/10 px-8 py-4 rounded-2xl font-black text-xs transition-all flex items-center gap-3">
                <i class="fas fa-satellite-dish text-[#D4AF37]"></i> مزامنة السيرفر
            </button>
        </header>

        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-10">
            <div class="stat-card p-6" onclick="setFilter('إلغاء')">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-orange-500/10 rounded-lg"><i class="fas fa-ban text-orange-500 text-xs"></i></div>
                    <span class="text-[8px] font-black text-slate-500 uppercase tracking-widest italic">Cancellations</span>
                </div>
                <h2 id="cancelCount" class="text-3xl font-black text-white">0</h2>
                <p class="text-[10px] text-slate-500 mt-1">طلبات بانتظار الحسم</p>
            </div>
            <div class="stat-card p-6" onclick="setFilter('تم الاستلام')">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-blue-500/10 rounded-lg"><i class="fas fa-box text-blue-400 text-xs"></i></div>
                    <span class="text-[8px] font-black text-slate-500 uppercase tracking-widest italic">Active Duty</span>
                </div>
                <h2 id="activeCount" class="text-3xl font-black text-white">0</h2>
                <p class="text-[10px] text-slate-500 mt-1">طلبات قيد المعالجة</p>
            </div>
            <div class="stat-card p-6" onclick="setFilter('✅')">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-green-500/10 rounded-lg"><i class="fas fa-check-circle text-green-500 text-xs"></i></div>
                    <span class="text-[8px] font-black text-slate-500 uppercase tracking-widest italic">Completed</span>
                </div>
                <h2 id="doneCount" class="text-3xl font-black text-white">0</h2>
                <p class="text-[10px] text-slate-500 mt-1">عمليات تمت بنجاح</p>
            </div>
            <div class="stat-card p-6" onclick="setFilter('قيد الانتظار')">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-2 bg-slate-500/10 rounded-lg"><i class="fas fa-radar text-slate-400 text-xs"></i></div>
                    <span class="text-[8px] font-black text-slate-500 uppercase tracking-widest italic">In Radar</span>
                </div>
                <h2 id="waitingCount" class="text-3xl font-black text-white">0</h2>
                <p class="text-[10px] text-slate-500 mt-1">طلبات في الانتظار</p>
            </div>
        </div>

        <div class="cyber-panel p-6">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 border-b border-white/5 pb-6">
                <div class="flex gap-2">
                    <button onclick="setFilter('all')" id="tab-all" class="tab-btn active">الكل</button>
                    <button onclick="setFilter('إلغاء')" id="tab-cancel" class="tab-btn">الإلغاءات</button>
                    <button onclick="setFilter('تم الاستلام')" id="tab-active" class="tab-btn">نشط</button>
                    <button onclick="setFilter('✅')" id="tab-done" class="tab-btn">مكتمل</button>
                </div>
                <div class="relative w-full md:w-64">
                    <input type="text" id="searchInput" oninput="renderCards()" placeholder="بحث سريع.." class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 px-10 text-xs outline-none search-glow transition-all">
                    <i class="fas fa-search absolute right-4 top-3.5 text-slate-500 text-[10px]"></i>
                </div>
            </div>

            <div id="adminArea" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
        </div>
    </div>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbxQiq-dn55ZaMfjhOBJzs-YXfrAt_IkcrbfCDhzgIDE3MIB09AGEtRTrCRpa7eCuObK2g/exec";
        let allOrders = [];
        let currentFilter = 'all';

        async function loadAdminData() {
            document.body.style.opacity = "0.7";
            try {
                const res = await fetch(`${scriptURL}?action=getAllOrders&t=${Date.now()}`);
                allOrders = await res.json();
                updateStats();
                renderCards();
            } catch (e) { console.error("Sync Error"); }
            finally { document.body.style.opacity = "1"; }
        }

        function updateStats() {
            document.getElementById('cancelCount').innerText = allOrders.filter(o => o.status.includes("إلغاء")).length;
            document.getElementById('activeCount').innerText = allOrders.filter(o => o.status === "تم الاستلام").length;
            document.getElementById('doneCount').innerText = allOrders.filter(o => o.status.includes("إنجاز") || o.status.includes("✅")).length;
            document.getElementById('waitingCount').innerText = allOrders.filter(o => o.status === "قيد الانتظار").length;
        }

        function setFilter(f) {
            currentFilter = f;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const tabMap = {'all': 'tab-all', 'إلغاء': 'tab-cancel', 'تم الاستلام': 'tab-active', '✅': 'tab-done'};
            if(tabMap[f]) document.getElementById(tabMap[f]).classList.add('active');
            renderCards();
        }

        function renderCards() {
            const container = document.getElementById('adminArea');
            const search = document.getElementById('searchInput').value.toLowerCase();
            
            let filtered = currentFilter === 'all' ? allOrders : allOrders.filter(o => o.status.includes(currentFilter));
            
            if(search) {
                filtered = filtered.filter(o => o.name.toLowerCase().includes(search) || o.car.toLowerCase().includes(search) || o.phone.includes(search));
            }

            container.innerHTML = filtered.map(o => `
                <div class="order-card p-6 rounded-3xl ${getStatusBorder(o.status)}">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <span class="text-[8px] font-mono text-slate-500 block mb-1 uppercase tracking-tighter">ID: ${o.id}</span>
                            <h4 class="text-lg font-black text-white">${o.car}</h4>
                            <p class="text-[10px] text-[#D4AF37] font-bold"><i class="fas fa-map-marker-alt ml-1"></i>${o.province}</p>
                        </div>
                        <div class="text-left">
                            <p class="text-xl font-black text-white">${o.price}</p>
                            <span class="text-[8px] font-black text-slate-500 uppercase">Currency IQD</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mb-5 text-[11px] bg-black/20 p-3 rounded-2xl">
                        <div>
                            <p class="text-[8px] text-slate-500 uppercase font-black mb-1">العميل</p>
                            <p class="font-bold truncate">${o.name}</p>
                        </div>
                        <div>
                            <p class="text-[8px] text-slate-500 uppercase font-black mb-1">المكتب المستلم</p>
                            <p class="font-bold text-blue-400 truncate">${o.claimedBy || 'بانتظار مكتب'}</p>
                        </div>
                        <div class="col-span-2 pt-2 border-t border-white/5">
                            <p class="text-[8px] text-slate-500 uppercase font-black mb-1">رقم الهاتف</p>
                            <p class="font-bold text-green-400 tracking-widest">${o.phone}</p>
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <button onclick="handle('adminReset', '${o.id}')" title="إعادة للرادار" class="flex-1 py-3 rounded-xl bg-white/5 hover:bg-blue-600/20 hover:text-blue-400 border border-white/5 transition-all text-[10px] font-bold uppercase">تصفير</button>
                        <button onclick="handle('complete', '${o.id}')" title="إنجاز قسري" class="flex-1 py-3 rounded-xl bg-white/5 hover:bg-green-600/20 hover:text-green-500 border border-white/5 transition-all text-[10px] font-bold uppercase">إنجاز</button>
                        <button onclick="handle('adminDelete', '${o.id}')" title="حذف نهائي" class="flex-1 py-3 rounded-xl bg-red-500/10 text-red-500 border border-red-500/20 hover:bg-red-500 hover:text-white transition-all text-[10px] font-bold uppercase">حذف</button>
                    </div>
                </div>
            `).join('');
        }

        function getStatusBorder(status) {
            if(status.includes('إلغاء')) return 'border-orange-500';
            if(status === 'تم الاستلام') return 'border-blue-500';
            if(status.includes('✅')) return 'border-green-500';
            return 'border-slate-700';
        }

        async function handle(action, id) {
            if(!confirm("تأكيد الإجراء السري؟")) return;
            try {
                const res = await fetch(`${scriptURL}?action=${action}&id=${id}&office=CHIEF_COMMANDER`);
                if((await res.text()) === "Success") loadAdminData();
            } catch(e) { alert("Error!"); }
        }

        window.onload = loadAdminData;
        setInterval(loadAdminData, 60000);
    </script>
</body>
</html>
