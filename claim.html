<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ | Ø§Ù„Ø­ÙˆØª ğŸ‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #0f172a; }
        .claim-card { background: white; border-radius: 2.5rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #002349; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-6">

    <div class="max-w-md w-full claim-card p-10 text-center border-t-[12px] border-[#D4AF37]">
        <div class="text-5xl mb-6">ğŸ¤</div>
        <h2 class="text-2xl font-black text-[#002349] mb-2">Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ Ø­Ø¬Ø²</h2>
        <p class="text-gray-400 text-sm font-bold mb-8">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ¨ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</p>

        <div class="space-y-4">
            <input type="text" id="officeName" placeholder="Ø§Ø³Ù… Ù…ÙƒØªØ¨ ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª" 
                   class="w-full px-6 py-4 bg-gray-50 border-2 border-gray-100 rounded-2xl outline-none focus:border-[#002349] transition-all font-bold text-center">
            
            <button onclick="submitClaim()" id="btnText" class="w-full py-5 bg-[#002349] text-[#D4AF37] rounded-2xl font-black text-xl shadow-xl hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-3">
                ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¢Ù†
            </button>
            <div id="loader" class="loader mx-auto mt-4"></div>
        </div>

        <p id="resultMessage" class="mt-6 font-bold text-sm transition-all"></p>
    </div>

    <script>
        const u = new URLSearchParams(window.location.search);
        const orderId = u.get('id');
        const scriptURL = "https://script.google.com/macros/s/AKfycbwAVmtBJwIF5TuXuVnz2ifBsuCl9Tj6jJnDdvOxhh1BtIlvb6Csv-uGkuLleYErVk6LUw/exec";

        async function submitClaim() {
            const office = document.getElementById('officeName').value.trim();
            const resultMsg = document.getElementById('resultMessage');
            const loader = document.getElementById('loader');
            const btn = document.getElementById('btnText');

            if (!office) {
                alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ¨ Ø£ÙˆÙ„Ø§Ù‹");
                return;
            }

            if (!orderId) {
                alert("Ø®Ø·Ø£: Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
                return;
            }

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„ÙˆØ¯Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø±
            loader.style.display = "block";
            btn.style.display = "none";

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ø³ØªÙ„Ø§Ù… (GET) Ø¥Ù„Ù‰ Apps Script
                const response = await fetch(`${scriptURL}?action=claim&id=${orderId}&office=${encodeURIComponent(office)}`);
                const text = await response.text();

                if (text.includes("Ø¨Ù†Ø¬Ø§Ø­")) {
                    resultMsg.innerText = text;
                    resultMsg.className = "mt-6 font-bold text-green-600 bg-green-50 p-4 rounded-xl";
                    document.querySelector('.claim-card').style.borderColor = "#22c55e";
                } else {
                    resultMsg.innerText = text;
                    resultMsg.className = "mt-6 font-bold text-red-600 bg-red-50 p-4 rounded-xl";
                    document.querySelector('.claim-card').style.borderColor = "#ef4444";
                }
            } catch (error) {
                resultMsg.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±";
                resultMsg.className = "mt-6 font-bold text-red-600";
                btn.style.display = "flex";
            } finally {
                loader.style.display = "none";
            }
        }
    </script>
</body>
</html>
