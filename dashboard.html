<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ù…ÙƒØ§ØªØ¨ Ø§Ù„Ø­ÙˆØª ğŸ‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-100 font-['Tajawal'] min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <header class="bg-[#002349] text-white p-8 rounded-[2.5rem] mb-6 shadow-2xl flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="text-center md:text-right">
                <h1 class="text-2xl font-black">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙƒØ§ØªØ¨ Ø§Ù„Ø°ÙƒÙŠØ© ğŸ‹</h1>
                <p id="cityLabel" class="text-[#D4AF37] font-bold">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­Ø§ÙØ¸ØªÙƒ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
            </div>
            <select id="citySelect" onchange="loadOrders()" class="bg-white text-slate-900 px-6 py-3 rounded-2xl font-black shadow-lg outline-none border-2 border-[#D4AF37]">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
                <option value="ÙƒØ±ÙƒÙˆÙƒ">ÙƒØ±ÙƒÙˆÙƒ</option>
                <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option>
                <option value="Ø£Ø±Ø¨ÙŠÙ„">Ø£Ø±Ø¨ÙŠÙ„</option>
                <option value="Ø§Ù„Ù…ÙˆØµÙ„">Ø§Ù„Ù…ÙˆØµÙ„</option>
                <option value="Ø§Ù„Ø¨ØµØ±Ø©">Ø§Ù„Ø¨ØµØ±Ø©</option>
                <option value="Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©">Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</option>
                <option value="Ø¯Ù‡ÙˆÙƒ">Ø¯Ù‡ÙˆÙƒ</option>
            </select>
        </header>

        <div id="ordersContainer" class="grid gap-4">
            <div class="bg-white p-12 rounded-[2.5rem] text-center shadow-sm">
                <p class="text-gray-400 font-bold">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©...</p>
            </div>
        </div>
    </div>

    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbzcDuYDz7t225v-3CoWzJJfoOgW8CEozpx16I7oLG7UIoxZwxOj3xsamdmQIb4Icsphgg/exec";

        async function loadOrders() {
            const city = document.getElementById('citySelect').value;
            if(!city) return;
            
            document.getElementById('cityLabel').innerText = "Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª: " + city;
            document.getElementById('ordersContainer').innerHTML = "<p class='text-center py-10 font-bold'>Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©...</p>";

            try {
                const response = await fetch(`${scriptURL}?action=getOrders&city=${encodeURIComponent(city)}`);
                const orders = await response.json();

                let html = '';
                if(orders.length === 0) {
                    html = '<div class="bg-white p-12 rounded-[2.5rem] text-center shadow-sm"><p class="text-gray-400 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ ' + city + ' Ø­Ø§Ù„ÙŠØ§Ù‹.</p></div>';
                } else {
                    orders.forEach(order => {
                        html += `
                        <div class="bg-white p-8 rounded-[2.5rem] shadow-md flex flex-col md:flex-row justify-between items-center gap-6 border-r-8 border-[#002349]">
                            <div class="text-center md:text-right">
                                <h3 class="font-black text-xl text-slate-800">${order.car}</h3>
                                <p class="text-slate-500 font-bold">Ø§Ù„Ø²Ø¨ÙˆÙ†: ${order.name} | Ø§Ù„Ù…ÙˆØ¹Ø¯: ${order.time}</p>
                                <p class="text-blue-600 text-xs font-black mt-1">ID: ${order.id}</p>
                            </div>
                            <button onclick="claim('${order.id}')" class="w-full md:w-auto bg-[#002349] text-[#D4AF37] px-10 py-4 rounded-2xl font-black text-lg hover:scale-105 transition-all shadow-lg">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ âœ…</button>
                        </div>`;
                    });
                }
                document.getElementById('ordersContainer').innerHTML = html;
            } catch(e) {
                document.getElementById('ordersContainer').innerHTML = "<p class='text-center text-red-500 font-bold'>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>";
            }
        }

        async function claim(id) {
            const office = prompt("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù…ÙƒØªØ¨Ùƒ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…:");
            if(!office) return;

            const response = await fetch(`${scriptURL}?action=claim&id=${id}&office=${encodeURIComponent(office)}`);
            const result = await response.text();
            
            if(result === "ØªÙ… Ø¨Ù†Ø¬Ø§Ø­") {
                alert("ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ø³Ù… Ù…ÙƒØªØ¨ " + office);
            } else {
                alert(result);
            }
            loadOrders();
        }
    </script>
</body>
</html>
